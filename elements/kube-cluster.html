<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-selector/core-selector.html">
<link rel="import" href="../bower_components/core-icons/core-icons.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="import" href="kube-core.html">
<link rel="import" href="kube-view-pods.html">
<link rel="import" href="kube-view-replicas.html">
<link rel="import" href="kube-view-services.html">
<link rel="import" href="kube-new-replc.html">

<polymer-element name="kube-cluster" attributes="baseurl apiver auth core view">
  <template>
    <style>
      :host {
        display: block;
      }
      #nav {
        display: block;
        margin-bottom: 1em;
      }
    </style>

    <core-selector valueattr="view" selected="{{view}}" id="nav">
      <paper-icon-button view="pods" fill isToggle icon="group-work"></paper-icon-button>
      <paper-icon-button view="replicationControllers" fill isToggle icon="apps"></paper-icon-button>
      <paper-icon-button view="services" fill isToggle icon="settings-ethernet"></paper-icon-button>
      <paper-icon-button view="minions" fill isToggle icon="cloud"></paper-icon-button>
      <paper-icon-button view="add" fill isToggle icon="add"></paper-icon-button>
    </core-selector>

    <section on-kube-replc-created="{{switchToView}}">
      <template if="{{view == 'pods'}}">
        <kube-view-pods core="{{core}}"></kube-view-pods>
      </template>
      <template if="{{view == 'replicationControllers'}}">
        <kube-view-replicas core="{{core}}"></kube-view-replicas>
      </template>
      <template if="{{view == 'services'}}">
        <kube-view-services core="{{core}}"></kube-view-services>
      </template>
      <template if="{{view == 'minions'}}">
        TODO: minions (VMs) view
      </template>
      <template if="{{view == 'add'}}">
        <kube-new-replc core="{{core}}"></kube-new-replc>
      </template>
    </section>

  </template>

  <script>
    Polymer({
      baseurl: 'http://localhost:8001',
      apiver: 'v1beta1',
      view: 'replicationControllers',

      observe: {
        'baseurl apiver auth': 'updateCoreConfig',
      },

      ready: function() {
        if (!this.core && this.baseurl) {
          this.core = document.createElement('kube-core');
          this.updateCoreConfig(null, true);
        }
      },

      updateCoreConfig: function(oldval, newval) {
        if (this.core && newval) {
          this.core.baseurl = this.baseurl;
          this.core.apiver = this.apiver;
          this.core.auth = this.auth;
        }
      },

      switchToView: function() {
        this.view = 'replicationControllers';
      }
    });
  </script>
</polymer-element>
